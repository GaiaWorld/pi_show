<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" name="viewport" />
    <script>
        var Module = {};
        var __cargo_web = {};
    </script>
</head>
<body>
    <canvas id="canvas" width = "1000px" height="700px"></canvas>
    
    <script src="../target/asmjs-unknown-emscripten/debug/gui.js"></script>
    <script>
        window.__gl = document.getElementById("canvas").getContext('webgl');
        var engine = Module._create_engine();
        var gui = Module._create_gui(engine, 1000, 700);
        var cfg, image;

        function load_ok() {
            var root = Module._create_node(gui);
            Module._append_child(gui, 1, root);
            Module._set_width(gui, root, 500.0);
            Module._set_height(gui, root, 300.0);
            Module._set_backgroud_rgba_color(gui, root, 1.0, 0.0, 0.0, 0.0);

            var node1 = Module._create_node(gui);
            Module._append_child(gui, root, node1);
            Module._set_width(gui, node1, 100.0);
            Module._set_height(gui, node1, 100.0);
            Module._set_backgroud_rgba_color(gui, node1, 0.0, 1.0, 0.0, 1.0);

            var node2 = Module._create_node(gui);
            Module._append_child(gui, root, node2);
            Module._set_width(gui, node2, 100.0);
            Module._set_height(gui, node2, 100.0);
            Module._set_backgroud_rgba_color(gui, node2, 0.0, 0.0, 1.0, 1.0);

            var u8Arr = new Uint8Array(image);
            window.__jsObj = cfg;
            window.__jsObj1 = u8Arr;
            window.__jsObj2 = "fontRes";
            var sdf_font = Module._create_sdf_font(gui);
            Module._add_sdf_font_res(gui, sdf_font);
            window.__jsObj = "HYXingKaiJ";
            window.__jsObj1 = "HYXingKaiJ";
            Module._add_font_face(gui, 0, 32, 500);

            var node3 = Module._create_text_node(gui);
            window.__jsObj = "测试一下";
            Module._set_text_content(gui, node3); // 文字内容
            Module._set_letter_spacing(gui, node3, 30); // 字符间距
            Module._set_line_height(gui, node3, 100); // 行高， 该函数设置行高的像素值
            window.__jsObj = "HYXingKaiJ";
            Module._set_font_family(gui, node3);
            Module._set_font_weight(gui, node3, 500); // 100 - 900, 500表示正常粗细， 小于500更细， 大于500更粗
            Module._set_text_rgba_color(gui, node3, 0.0, 1.0, 0.0, 1.0); // r, g, b, a
            Module._append_child(gui, root, node3);
            // var node3 = Module._create_node(gui);
            // Module._append_child(gui, root, node3);
            // Module._set_width(gui, node3, 100.0);
            // Module._set_height(gui, node3, 100.0);
            // Module._set_backgroud_rgba_color(gui, node3, 0.0, 1.0, 1.0, 1.0);

            var node4 = Module._create_node(gui);
            Module._insert_before(gui, root, node4, node3, 1); //child_id: u32, brother_id: u32, brother_index: u32
            Module._set_width(gui, node4, 100.0);
            Module._set_height(gui, node4, 100.0);
            Module._set_backgroud_rgba_color(gui, node4, 1.0, 1.0, 1.0, 1.0);

            Module._run(gui);
        }
        
        function newXMLHttpRequest() {
            var xmlhttp;
            if (window.XMLHttpRequest)
            {
                //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
                xmlhttp=new XMLHttpRequest();
            }
            else
            {
                // IE6, IE5 浏览器执行代码
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            return xmlhttp;
        }

        var xmlhttp = newXMLHttpRequest();
        xmlhttp.open("GET","hanyi.dfc",true);
        xmlhttp.onreadystatechange=function(){
            if (xmlhttp.readyState==4 && xmlhttp.status==200){
                cfg = new Uint8Array(xmlhttp.response);
                console.log("cfg-----------------------------------",cfg);
                if (image) {
                    load_ok()
                }
            }
        }
        xmlhttp.responseType = 'arraybuffer';
        xmlhttp.send();

        var xmlhttp_image = newXMLHttpRequest();
        xmlhttp_image.open("GET","hanyi.dft", true);
        xmlhttp_image.onreadystatechange=function(){
            if (xmlhttp_image.readyState==4 && xmlhttp_image.status==200){
                image = xmlhttp_image.response;
                if (cfg) {
                    load_ok()
                }
            }
        }
        xmlhttp_image.responseType = 'arraybuffer';
        xmlhttp_image.send();
    </script>
</body>
</html>