<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" name="viewport" />
    <script>
        var Module = {};
        var __cargo_web = {};
    </script>
</head>
<body>
    <canvas id="canvas" width = "1000px" height="700px"></canvas>
    <script>
        var RUST_BACKTRACE = 1;
    </script>
    <script src="../target/asmjs-unknown-emscripten/debug/gui.js"></script>
    <script src="./shader/image.js"></script> <!--图片shader-->
    <script src="./shader/sdf.js"></script>   <!--sdfshader-->
    <script src="./shader/text.js"></script> <!--文字shader-->
    <script src="./shader/init.js"></script> <!--创建engine  设置shadercode-->
    <script>
        var gui = Module._create_gui(engine, 1000, 700);


        var body = Module._create_node(gui);
        Module._append_child(gui, 1, body);
        Module._set_width(gui, body, 700);
        Module._set_height(gui, body, 400);

        Module._run(gui);

        var root = Module._create_node(gui);
        var image_node = Module._create_image_node(gui);
        Module._append_child(gui, root, image_node);
        Module._append_child(gui, body, root);
        Module._set_width(gui, root, 700);
        Module._set_height(gui, root, 400);
        Module._set_backgroud_rgba_color(gui, root, 0.5, 0.0, 0.5, 1.0);

        // var root = Module._create_node(gui);
        // Module._append_child(gui, body, root);
        // Module._set_width(gui, root, 512);
        // Module._set_height(gui, root, 512);
        // Module._set_backgroud_rgba_color(gui, root, 0.5, 0.5, 0.5, 1.0);

        Module._set_width(gui, image_node, 100);
        Module._set_height(gui, image_node, 100);
        Module._run(gui);
        
        var image = new Image();

        image.onload = () => {
            window.__jsObj = image;
            window.__jsObj1 = "./20190422165842.jpg";
            Module._set_src(gui, image_node, 0, 0);
            // Module._set_width(gui, image_node, 100);
            // Module._set_height(gui, image_node, 100);

            Module._run(gui);
            
            //修改图片
            setTimeout(() => {
                var image = new Image();
                window.__jsObj1 = "./test_image.jpg";
                image.onload = () => {
                    window.__jsObj = image;
                    window.__jsObj = image;                
                    Module._set_src(gui, image_node, 0, 0);
                    Module._run(gui);
                };
                image.src = "./test_image.jpg";
            }, 2000);
        };
        image.src = "./20190422165842.jpg";

    </script>
</body>
</html>