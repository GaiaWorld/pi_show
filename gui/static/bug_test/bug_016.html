<!--bug  渲染状态 深度写切换频繁-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" name="viewport" />
    <script>
        var Module = {};
        var __cargo_web = {};
        var YGEdgeLeft = 0;
        var YGEdgeTop = 1;
        var YGEdgeRight = 2;
        var YGEdgeBottom = 3;
        var YGEdgeStart = 4;
        var YGEdgeEnd = 5;
        var YGEdgeHorizontal = 6;
        var YGEdgeVertical = 7;
        var YGEdgeAll = 8;
    </script>
</head>
<body>
    <canvas id="canvas" width = "1000px" height="700px"></canvas>
    <script src="../../target/asmjs-unknown-emscripten/debug/gui.js"></script>
    <script src="../shader/clip.js"></script>
    <script src="../shader/color.js"></script>
    <script src="../shader/image.js"></script>
    <script src="../shader/text.js"></script>
    <script src="../shader/init.js"></script>
    <script>
        var gui = Module._create_gui(engine, 1000, 700);
        var image = new Image();

        image.onload = () => {
            var node1 = Module._create_node(gui);
            Module._append_child(gui, node1, 1); // 接口已修改， node和parent顺序颠倒
            Module._set_width(gui, node1, 200.0);
            Module._set_height(gui, node1, 200.0);
            Module._set_background_rgba_color(gui, node1, 1.0, 0.0, 0.0, 1.0);

            
            // var nodeimage = Module._create_node(gui);
            // Module._append_child(gui, nodeimage, 1); // 接口已修改， node和parent顺序颠倒
            // Module._set_width(gui, nodeimage, 110.0);
            // Module._set_height(gui, nodeimage, 110.0);
            // Module._set_margin(gui, nodeimage, YGEdgeLeft, 10);
            // Module._set_background_rgba_color(gui, nodeimage, 0.0, 1.0, 1.0, 0.5);
            // Module._set_border_radius(gui, nodeimage, 20);
            var node_image = Module._create_image_node(gui);
            Module._append_child(gui, node_image, 1);
            window.__jsObj = image;
            window.__jsObj1 = "../test_image/xxx.png";
            Module._set_src(gui, node_image, 1, 0);
            Module._set_image_clip(gui, node_image, 0, 0, 0.5, 0.5);
            // Module._set_object_fit(gui, node_image, FitType_Fill);
            Module._set_width(gui, node_image, 300);
            Module._set_height(gui, node_image, 100);
            Module._set_border_radius(gui, node_image, 20);

            var node2 = Module._create_node(gui);
            Module._append_child(gui, node2, 1); // 接口已修改， node和parent顺序颠倒
            Module._set_width(gui, node2, 100.0);
            Module._set_height(gui, node2, 100.0);
            Module._set_margin(gui, node2, YGEdgeLeft, 10);
            Module._set_background_rgba_color(gui, node2, 1.0, 0.0, 0.0, 0.5);

            var node2 = Module._create_node(gui);
            Module._append_child(gui, node2, 1); // 接口已修改， node和parent顺序颠倒
            Module._set_width(gui, node2, 50.0);
            Module._set_height(gui, node2, 50.0);
            Module._set_margin(gui, node2, YGEdgeLeft, 10);
            Module._set_background_rgba_color(gui, node2, 0.0, 1.0, 0.0, 1.0);

            var node3 = Module._create_node(gui);
            Module._append_child(gui, node3, 1); // 接口已修改， node和parent顺序颠倒
            Module._set_width(gui, node3, 80.0);
            Module._set_height(gui, node3, 80.0);
            Module._set_margin(gui, node3, YGEdgeLeft, 10);
            Module._set_background_rgba_color(gui, node3, 0.0, 1.0, 0.0, 0.5);
            
            var i = 100;
            var render = function(){
                Module._render(gui);
                if (i == 100){
                    i = 200;
                    Module._set_width(gui, node2, i);
                }else {
                    i = 100;
                    Module._set_width(gui, node2, i);
                }
                
                requestAnimationFrame(() => {
                    render();
                });
            }
            render();
            // setTimeout(() => {
            //         render();
            //     }, 1000);
        };
        image.src = "../test_image/xxx.png";
    </script> 
</body>
</html>
