<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" name="viewport" />
    <script>
        var Module = {};
        var __cargo_web = {};
    </script>
</head>
<body>
    <canvas id="canvas" width = "1000px" height="700px"></canvas>
    <script>
        var RUST_BACKTRACE = 1;
    </script>
    <script src="../target/asmjs-unknown-emscripten/debug/gui.js"></script>
    <script>
        var gl = document.getElementById("canvas").getContext('webgl');
        window.__gl = gl;

        var engine = Module._create_engine();
        var gui = Module._create_gui(engine, 1000, 700);

        var body = Module._create_node(gui);
        Module._set_width(gui, body, 1000);
        Module._set_height(gui, body, 700);
        Module._append_child(gui, 1, body);


        var root = Module._create_node(gui);
        Module._set_width_percent(gui, root, 100);
        Module._set_height_percent(gui, root, 100);
        Module._set_backgroud_rgba_color(gui, root, 0.0, 1.0, 0.0, 0.8);
        Module._append_child(gui, body, root);
        Module._run(gui);

        let s0, s1, s2, count = 0;
        let div = create10050Child();

            let c1 = create8050Child();

                s0 = create80Child();
                    s1 = create80Child();
                        s2 = create80Child();
                        Module._append_child(gui, s1, s2);
                    Module._append_child(gui, s0, s1);
                Module._append_child(gui, c1, s0);

            Module._append_child(gui, div, c1);

            let c2 = create8050Child();
                let z0 = create80Child();
                Module._append_child(gui, c2, z0);
            Module._append_child(gui, div, c2);

        Module._append_child(gui, root, div);
        Module._run(gui);


        function create80Child() {
            let child = Module._create_node(gui);

            Module._set_width_percent(gui, child, 80);
            Module._set_height_percent(gui, child, 80);
            if (count % 2) {
                Module._set_backgroud_rgba_color(gui, child, 1.0, 0.0, 0.0, 0.8);
            } else {
                Module._set_backgroud_rgba_color(gui, child, 1.0, 0.0, 1.0, 0.8);
            }

            return child;
        }
        
        function create10050Child() {
            let child = Module._create_node(gui);

            Module._set_width_percent(gui, child, 100);
            Module._set_height_percent(gui, child, 50);
            Module._set_backgroud_rgba_color(gui, child, 0.0, 1.0, 0.0, 0.8);

            return child;
        }

        function create8050Child() {
            let child = Module._create_node(gui);

            Module._set_width_percent(gui, child, 80);
            Module._set_height_percent(gui, child, 50);
            Module._set_backgroud_rgba_color(gui, child, 1.0, 1.0, 0.0, 0.8);

            return child;
        }

        function change() {
            count++;
            
            console.warn(`_query: start`);
            const res = Module._query(gui, 700, 100, 1);
            console.warn(`_query: ${res}`);
            console.warn(`_query: end`);

            Module._remove_child(gui, s1, s2);
            Module._remove_child(gui, s0, s1);
            Module._remove_child(gui, c1, s0);

            s0 = create80Child();
                s1 = create80Child();
                    s2 = create80Child();
                    Module._append_child(gui, s1, s2);
                Module._append_child(gui, s0, s1);
            Module._append_child(gui, c1, s0);

            Module._run(gui);

            setTimeout(change, 2000);
        }

        change();

    </script>
</body>
</html>